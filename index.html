<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>最速判別</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --accent-color: #00ff00;
            --blue-gradient: linear-gradient(90deg, #007bff, #00c6ff);
        }
        body {
            font-family: -apple-system, sans-serif;
            background: var(--bg-color);
            color: white;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: env(safe-area-inset-top, 10px) 15px env(safe-area-inset-bottom, 10px) 15px;
        }

        /* 1. 設定分布（画面上部） */
        #resultArea {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 12px; }
        td { padding: 10px 8px; border-bottom: 1px solid #333; }
        .setting-name { width: 50px; font-weight: bold; font-size: 13px; color: #aaa; }
        .bar-container { flex: 1; background: #333; height: 16px; border-radius: 8px; overflow: hidden; }
        .bar { height: 100%; background: var(--blue-gradient); transition: width 0.3s ease-out; }
        .percent { width: 65px; font-size: 16px; font-weight: bold; color: var(--accent-color); text-align: right; }

        /* 中間の数値モニタ */
        .monitor {
            display: flex; justify-content: space-around;
            background: #252525; padding: 12px; border-radius: 12px; margin-bottom: 15px;
        }
        .monitor div { text-align: center; }
        .monitor span { display: block; font-size: 10px; color: #888; }
        .monitor b { font-size: 20px; }

        /* 2. 機種選択（下から2番目・1行固定） */
        .mode-selector {
            display: flex;
            justify-content: space-between;
            gap: 4px;
            margin-bottom: 10px;
            width: 100%;
        }
        .mode-btn {
            flex: 1; /* 幅を均等にパーセント分配 */
            white-space: nowrap; /* 改行防止 */
            padding: 12px 0;
            border: 1px solid #444;
            background: #333;
            color: #fff;
            border-radius: 8px;
            font-weight: bold;
            font-size: 11px;
            cursor: pointer;
        }
        .mode-btn.active {
            background: #007bff;
            border-color: #007bff;
        }

        /* 3. 入力欄（最下部） */
        .input-wrapper { margin-bottom: 10px; }
        #masterInput {
            width: 100%;
            padding: 15px;
            font-size: 36px;
            text-align: center;
            letter-spacing: 6px;
            border: 2px solid #444;
            border-radius: 16px;
            background: #000;
            color: var(--accent-color);
            inputmode: numeric;
            box-sizing: border-box;
        }
        .guide { text-align: center; font-size: 11px; color: #666; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div id="resultArea">
        <div class="guide" id="statusLabel">機種を選択して入力</div>
        <div id="resultTable"></div>
    </div>

    <div class="monitor">
        <div><span>G数</span><b id="dispG">0</b></div>
        <div><span>BIG</span><b id="dispB">0</b></div>
        <div><span>REG</span><b id="dispR">0</b></div>
    </div>

    <div class="mode-selector">
        <button id="btn-mr" class="mode-btn active" onclick="setMode('mr')">ミスター</button>
        <button id="btn-my5" class="mode-btn" onclick="setMode('my5')">マイⅤ</button>
        <button id="btn-hp3" class="mode-btn" onclick="setMode('hp3')">ハッピー</button>
        <button id="btn-fn2" class="mode-btn" onclick="setMode('fn2')">ファンキー</button>
    </div>

    <div class="input-wrapper">
        <input type="tel" id="masterInput" maxlength="8" placeholder="00000000" oninput="processInput()">
    </div>
</div>

<script>
const masterData = {
    mr: { name: "ミスタージャグラー", config: [
        {s:1, b:268.6, r:374.5}, {s:2, b:267.5, r:354.2}, {s:3, b:260.1, r:331.0},
        {s:4, b:249.2, r:291.3}, {s:5, b:240.9, r:257.0}, {s:6, b:237.4, r:237.4}
    ]},
    my5: { name: "マイジャグラーⅤ", config: [
        {s:1, b:273.1, r:409.6}, {s:2, b:270.8, r:385.5}, {s:3, b:266.4, r:336.1},
        {s:4, b:254.0, r:290.0}, {s:5, b:240.1, r:268.6}, {s:6, b:229.1, r:229.1}
    ]},
    hp3: { name: "ハッピーVⅢ", config: [
        {s:1, b:273.1, r:397.2}, {s:2, b:270.8, r:362.1}, {s:3, b:263.2, r:332.7},
        {s:4, b:254.0, r:300.6}, {s:5, b:239.2, r:273.1}, {s:6, b:226.0, r:256.0}
    ]},
    fn2: { name: "ファンキー2", config: [
        {s:1, b:266.4, r:439.8}, {s:2, b:259.0, r:407.1}, {s:3, b:256.0, r:366.1},
        {s:4, b:249.2, r:322.8}, {s:5, b:240.9, r:299.3}, {s:6, b:219.9, r:262.1}
    ]}
};

let currentMode = 'mr';

function setMode(mode) {
    currentMode = mode;
    Object.keys(masterData).forEach(k => {
        document.getElementById('btn-' + k).classList.toggle('active', k === mode);
    });
    document.getElementById('statusLabel').innerText = masterData[mode].name + " 判別中";
    processInput();
}

function processInput() {
    const val = document.getElementById('masterInput').value;
    if (val.length < 8) {
        ["dispG", "dispB", "dispR"].forEach(id => document.getElementById(id).innerText = "0");
        return;
    }
    const g = parseInt(val.substring(0, 4)), b = parseInt(val.substring(4, 6)), r = parseInt(val.substring(6, 8));
    document.getElementById('dispG').innerText = g;
    document.getElementById('dispB').innerText = b;
    document.getElementById('dispR').innerText = r;
    if (g > 0) calculate(g, b, r);
}

function calculate(G, B, R) {
    let totalProb = 0;
    const currentConfig = masterData[currentMode].config;
    const results = currentConfig.map(conf => {
        const pB = Math.pow(1/conf.b, B) * Math.exp(-G/conf.b);
        const pR = Math.pow(1/conf.r, R) * Math.exp(-G/conf.r);
        const prob = pB * pR;
        totalProb += prob;
        return { s: conf.s, p: prob };
    });
    let html = "<table>";
    results.forEach(res => {
        const percent = totalProb > 0 ? ((res.p / totalProb) * 100).toFixed(1) : 0;
        html += `<tr>
            <td class="setting-name">設定${res.s}</td>
            <td><div class="bar-container"><div class="bar" style="width: ${percent}%"></div></div></td>
            <td class="percent">${percent}%</td>
        </tr>`;
    });
    document.getElementById('resultTable').innerHTML = html + "</table>";
}

window.onload = () => {
    document.getElementById('masterInput').focus();
    setMode('mr');
};
</script>
</body>
</html>